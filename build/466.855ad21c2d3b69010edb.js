"use strict";(self.webpackChunkproduction_project=self.webpackChunkproduction_project||[]).push([[466],{3818:(e,t,r)=>{r.r(t),r.d(t,{default:()=>Q});var a=r(3007),n=r(4478),i=r(7294),s=r(417),c=r(9250),o=r(1233),l=r(5420),u=r(5550),d=r(1715),m=r(6628).p.injectEndpoints({endpoints:function(e){return{getArticleRecommendationsList:e.query({query:function(e){return{url:"/articles",params:{_limit:e}}}})}},overrideExisting:!1}).useGetArticleRecommendationsListQuery,x=r(5893),p=(0,i.memo)((function(e){var t=e.className,r=(0,n.$)().t,i=m(3),c=i.data,o=i.isLoading,l=i.error;return o||l||!c?null:(0,x.jsxs)(u.g,{gap:"8",className:(0,a.A)("",{},[t]),children:[(0,x.jsx)(d.xv,{size:d.yH.L,title:r("Рекомендуем")}),(0,x.jsx)(s.wD,{articles:c,target:"_blank",virtualized:!1})]})})),f=r(7779),h=r(4268),g=r(5861),v=r(4687),j=r.n(v),b=(0,h.hg)("articleDetailsPage/fetchArticleRecommendations",function(){var e=(0,g.Z)(j().mark((function e(t,r){var a,n,i;return j().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=r.extra,n=r.rejectWithValue,e.prev=1,e.next=4,a.api.get("/articles",{params:{_limit:4}});case 4:if((i=e.sent).data){e.next=7;break}throw new Error;case 7:return e.abrupt("return",i.data);case 10:return e.prev=10,e.t0=e.catch(1),e.abrupt("return",n("error"));case 13:case"end":return e.stop()}}),e,null,[[1,10]])})));return function(t,r){return e.apply(this,arguments)}}()),C=(0,h.HF)({selectId:function(e){return e.id}}),w=(C.getSelectors((function(e){var t;return(null===(t=e.articleDetailsPage)||void 0===t?void 0:t.recommendations)||C.getInitialState()})),(0,h.oM)({name:"articleDetailsCommentsSlice",initialState:C.getInitialState({isLoading:!1,error:void 0,ids:[],entities:{}}),reducers:{},extraReducers:function(e){e.addCase(b.pending,(function(e){e.error=void 0,e.isLoading=!0})).addCase(b.fulfilled,(function(e,t){e.isLoading=!1,C.setAll(e,t.payload)})).addCase(b.rejected,(function(e,t){e.isLoading=!1,e.error=t.payload}))}}).reducer),L=(0,h.hg)("articleDetails/fetchCommentsByArticleId",function(){var e=(0,g.Z)(j().mark((function e(t,r){var a,n,i;return j().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=r.extra,n=r.rejectWithValue,t){e.next=3;break}return e.abrupt("return",n("error"));case 3:return e.prev=3,e.next=6,a.api.get("/comments",{params:{articleId:t,_expand:"user"}});case 6:if((i=e.sent).data){e.next=9;break}throw new Error;case 9:return e.abrupt("return",i.data);case 12:return e.prev=12,e.t0=e.catch(3),e.abrupt("return",n("error"));case 15:case"end":return e.stop()}}),e,null,[[3,12]])})));return function(t,r){return e.apply(this,arguments)}}()),N=(0,h.HF)({selectId:function(e){return e.id}}),k=N.getSelectors((function(e){var t;return(null===(t=e.articleDetailsPage)||void 0===t?void 0:t.comments)||N.getInitialState()})),A=(0,h.oM)({name:"articleDetailsCommentsSlice",initialState:N.getInitialState({isLoading:!1,error:void 0,ids:[],entities:{}}),reducers:{},extraReducers:function(e){e.addCase(L.pending,(function(e){e.error=void 0,e.isLoading=!0})).addCase(L.fulfilled,(function(e,t){e.isLoading=!1,N.setAll(e,t.payload)})).addCase(L.rejected,(function(e,t){e.isLoading=!1,e.error=t.payload}))}}).reducer,y=(0,f.UY)({recommendations:w,comments:A});var I=r(9332),S=r(5255),D=r(3942),z=r(7081),O=(0,r(2222).P1)(s.wq,z.m5,(function(e,t){return!(!e||!t)&&e.user.id===t.id})),_=function(e){var t=e.className,r=(0,n.$)("article-details").t,o=(0,c.s0)(),l=((0,D.v9)(z.m5),(0,D.v9)(s.wq)),d=(0,D.v9)(O),m=(0,i.useCallback)((function(){o(I.h3.articles)}),[o]),p=(0,i.useCallback)((function(){o("".concat(I.h3.article_details).concat(null==l?void 0:l.id,"/edit"))}),[o,null==l?void 0:l.id]);return(0,x.jsxs)(u.U,{max:!0,justify:"between",className:(0,a.A)("",{},[t]),children:[(0,x.jsx)(S.zx,{theme:S.bn.OUTLINE,onClick:m,children:r("Назад к списку")}),d&&(0,x.jsx)(S.zx,{theme:S.bn.OUTLINE,onClick:p,children:r("Редактировать")})]})},q=(0,i.lazy)((function(){return r.e(933).then(r.bind(r,1933))})),E=r(2949),U=r(3312),H=r(6897);const P={CommentCard:"xIHByGcu",header:"dsH_3Oqu",username:"dw82WMzO",loading:"V0iZ1Un3"};var R=(0,i.memo)((function(e){var t=e.className,r=e.comment;return e.isLoading?(0,x.jsxs)("div",{className:(0,a.A)(P.CommentCard,{},[t,P.loading]),children:[(0,x.jsxs)("div",{className:P.header,children:[(0,x.jsx)(U.O,{width:30,height:30,border:"50%"}),(0,x.jsx)(U.O,{height:16,width:100,className:P.username})]}),(0,x.jsx)(U.O,{className:P.text,width:"100%",height:50})]}):r?(0,x.jsxs)(u.g,{max:!0,gap:"8",className:(0,a.A)(P.CommentCard,{},[t]),children:[(0,x.jsxs)(H.F,{to:"".concat(I.h3.profile).concat(r.user.id),className:P.header,children:[r.user.avatar?(0,x.jsx)(E.q,{size:30,src:r.user.avatar}):null,(0,x.jsx)(d.xv,{className:P.username,title:r.user.username})]}),(0,x.jsx)(d.xv,{className:P.text,text:r.text})]}):null})),W=(0,i.memo)((function(e){var t=e.className,r=e.isLoading,i=e.comments,s=(0,n.$)().t;return r?(0,x.jsxs)(u.g,{gap:"16",max:!0,className:(0,a.A)("",{},[t]),children:[(0,x.jsx)(R,{isLoading:!0}),(0,x.jsx)(R,{isLoading:!0}),(0,x.jsx)(R,{isLoading:!0})]}):(0,x.jsx)(u.g,{gap:"16",max:!0,className:(0,a.A)("",{},[t]),children:null!=i&&i.length?i.map((function(e){return(0,x.jsx)(R,{isLoading:r,comment:e},e.id)})):(0,x.jsx)(d.xv,{text:s("Комментарии отсутствуют")})})})),$=r(9970),F=r(379),V=function(e){var t,r;return null===(t=e.articleDetailsPage)||void 0===t||null===(r=t.comments)||void 0===r?void 0:r.isLoading},Z=r(3918),M=(0,h.hg)("articleDetails/addCommentForArticle",function(){var e=(0,g.Z)(j().mark((function e(t,r){var a,n,i,s,c,o,l;return j().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=r.extra,n=r.dispatch,i=r.rejectWithValue,s=r.getState,c=(0,z.m5)(s()),o=(0,Z.wq)(s()),c&&t&&o){e.next=5;break}return e.abrupt("return",i("no data"));case 5:return e.prev=5,e.next=8,a.api.post("/comments",{articleId:o.id,userId:c.id,text:t});case 8:if((l=e.sent).data){e.next=11;break}throw new Error;case 11:return n(L(o.id)),e.abrupt("return",l.data);case 15:return e.prev=15,e.t0=e.catch(5),e.abrupt("return",i("error"));case 18:case"end":return e.stop()}}),e,null,[[5,15]])})));return function(t,r){return e.apply(this,arguments)}}()),T=function(e){var t=e.className,r=e.id,s=(0,n.$)().t,c=(0,D.v9)(k.selectAll),o=(0,D.v9)(V),l=(0,D.I0)(),m=(0,i.useCallback)((function(e){l(M(e))}),[l]);return(0,$.Q)((function(){l(L(r))})),(0,x.jsxs)(u.g,{max:!0,gap:"16",className:(0,a.A)("",{},[t]),children:[(0,x.jsx)(d.xv,{size:d.yH.L,title:s("Комментарии")}),(0,x.jsx)(i.Suspense,{fallback:(0,x.jsx)(F.a,{}),children:(0,x.jsx)(q,{onSendComment:m})}),(0,x.jsx)(W,{isLoading:o,comments:c})]})},B={articleDetailsPage:y},G=function(e){var t=e.className,r=((0,n.$)("article-details").t,(0,c.UO)().id);return(0,x.jsx)(o.W,{reducers:B,removeAfterUnmount:!0,children:(0,x.jsx)(l.T,{className:(0,a.A)("adu8fSDx",{},[t]),children:(0,x.jsxs)(u.g,{gap:"16",max:!0,children:[(0,x.jsx)(_,{}),(0,x.jsx)(s.D0,{id:r}),(0,x.jsx)(p,{}),(0,x.jsx)(T,{id:r})]})})})};const Q=(0,i.memo)(G)}}]);