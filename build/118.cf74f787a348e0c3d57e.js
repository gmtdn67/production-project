"use strict";(self.webpackChunkproduction_project=self.webpackChunkproduction_project||[]).push([[118],{8950:function(e,a,t){t.r(a),t.d(a,{default:function(){return B}});var s=t(7294),r=t(3007),c=t(1233),l=t(5401),i=t(5420),o=t(4268),n=t(2241);const d=e=>e.articlesPage?.isLoading||!1,u=e=>e.articlesPage?.error,g=e=>e.articlesPage?.view||n.GA.SMALL,p=e=>e.articlesPage?.page||1,h=e=>e.articlesPage?.order||"asc",v=e=>e.articlesPage?.sort||n.$B.CREATED,m=e=>e.articlesPage?.search??"",y=e=>e.articlesPage?.type||n.Iq.ALL;var x=t(1283);const f=(0,o.hg)("articlesPage/fetchArticlesList",(async(e,a)=>{const{extra:t,rejectWithValue:s,getState:r}=a,c=r().articlesPage?.limit||9,l=h(r()),i=v(r()),o=m(r()),d=p(r()),u=y(r());try{g={sort:i,order:l,search:o,type:u},window.history.pushState(null,"",function(e){const a=new URLSearchParams(window.location.search);return Object.entries(e).forEach((([e,t])=>{void 0!==t&&a.set(e,t)})),`?${a.toString()}`}(g));const e=await t.api.get("/articles",{params:{_expand:"user",_limit:c,_page:d,_sort:i,_order:l,q:o,type:u===n.Iq.ALL?void 0:u}});if(!e.data)throw new Error;return e.data}catch(e){return s("error")}var g})),P=(0,o.HF)({selectId:e=>e.id}),S=P.getSelectors((e=>e.articlesPage||P.getInitialState())),j=(0,o.oM)({name:"articlesPageSlice",initialState:P.getInitialState({isLoading:!1,error:void 0,ids:[],entities:{},view:n.GA.SMALL,page:1,hasMore:!0,_inited:!1,limit:9,sort:n.$B.CREATED,search:"",order:"asc",type:n.Iq.ALL}),reducers:{setView:(e,a)=>{e.view=a.payload,localStorage.setItem(x.f,a.payload)},setPage:(e,a)=>{e.page=a.payload},setOrder:(e,a)=>{e.order=a.payload},setSort:(e,a)=>{e.sort=a.payload},setType:(e,a)=>{e.type=a.payload},setSearch:(e,a)=>{e.search=a.payload},initState:e=>{const a=localStorage.getItem(x.f);e.view=a,e.limit=a===n.GA.BIG?4:9,e._inited=!0}},extraReducers:e=>{e.addCase(f.pending,((e,a)=>{e.error=void 0,e.isLoading=!0,a.meta.arg.replace&&P.removeAll(e)})).addCase(f.fulfilled,((e,a)=>{e.isLoading=!1,e.hasMore=a.payload.length>=e.limit,a.meta.arg.replace?P.setAll(e,a.payload):P.addMany(e,a.payload)})).addCase(f.rejected,((e,a)=>{e.isLoading=!1,e.error=a.payload}))}}),{reducer:L,actions:C}=j,w=(0,o.hg)("articlesPage/fetchNextArticlesPage",(async(e,a)=>{const{getState:t,dispatch:s}=a,r=t().articlesPage?.hasMore,c=p(t()),l=d(t());r&&!l&&(s(C.setPage(c+1)),s(f({})))}));var A=t(2327),N=t(9319),b=t(8312),k=t(6425),I=t(595),R={sortWrapper:"pyOjonnp",search:"QkNSez8q",tabs:"JHbc4jKB"},T=t(5893);const _=({className:e})=>{const{t:a}=(0,A.$)(),t=(0,N.v9)(g),c=(0,l.T)(),i=(0,N.v9)(h),o=(0,N.v9)(v),d=(0,N.v9)(m),u=(0,N.v9)(y),p=(0,s.useCallback)((()=>{c(f({replace:!0}))}),[c]),x=function(e,a){const t=(0,s.useRef)();return(0,s.useCallback)(((...a)=>{t.current&&clearTimeout(t.current),t.current=setTimeout((()=>{e(...a)}),500)}),[e,500])}(p),P=(0,s.useCallback)((e=>{c(C.setView(e)),x()}),[c,x]),S=(0,s.useCallback)((e=>{c(C.setSort(e)),c(C.setPage(1)),x()}),[c,x]),j=(0,s.useCallback)((e=>{c(C.setOrder(e)),c(C.setPage(1)),x()}),[c,x]),L=(0,s.useCallback)((e=>{c(C.setSearch(e)),c(C.setPage(1)),x()}),[c,x]),w=(0,s.useCallback)((e=>{c(C.setType(e)),c(C.setPage(1)),p()}),[c,p]);return(0,T.jsxs)("div",{className:(0,r.A)(R.ArticlesPageFilters,{},[e]),children:[(0,T.jsxs)("div",{className:R.sortWrapper,children:[(0,T.jsx)(I.x,{order:i,sort:o,onChangeOrder:j,onChangeSort:S}),(0,T.jsx)(n.Vv,{view:t,onViewClick:P})]}),(0,T.jsx)(k.Z,{className:R.search,children:(0,T.jsx)(b.I,{placeholder:a("Поиск"),value:d,onChange:L})}),(0,T.jsx)(n.XL,{value:u,onChangeType:w,className:R.tabs})]})};var E=t(9655),q=t(1715);const M=({className:e})=>{const{t:a}=(0,A.$)(),t=(0,N.v9)(S.selectAll),s=(0,N.v9)(d),r=(0,N.v9)(g),c=(0,N.v9)(u),[l]=(0,E.lr)();return c?(0,T.jsx)(q.xv,{text:a("Ошибка при загрузке статей"),theme:q.lg.ERROR}):(0,T.jsx)(n.wD,{isLoading:s,view:r,articles:t,className:e})},G={articlesPage:L},O=e=>{const{className:a}=e,t=(0,l.T)(),o=(0,s.useCallback)((()=>{t(w())}),[t]);return(0,T.jsx)(c.W,{reducers:G,removeAfterUnmount:!1,children:(0,T.jsxs)(i.T,{onScrollEnd:o,className:(0,r.A)("i0h17Gqm",{},[a]),children:[(0,T.jsx)(_,{}),(0,T.jsx)(M,{className:"UsH35LqR"})]})})};var B=(0,s.memo)(O)},8312:function(e,a,t){t.d(a,{I:function(){return l}});var s=t(7294),r=t(3007),c=t(5893);const l=(0,s.memo)((e=>{const{className:a,value:t,onChange:l,type:i="text",placeholder:o,autofocus:n,readonly:d,...u}=e,g=(0,s.useRef)(null),[p,h]=(0,s.useState)(!1),[v,m]=(0,s.useState)(0),y=p&&!d;return(0,s.useEffect)((()=>{n&&(h(!0),g.current?.focus())}),[n]),(0,c.jsxs)("div",{className:(0,r.A)("LuFDUWoP",{},[a]),children:[o&&(0,c.jsx)("div",{className:"emAQQ85i",children:`${o}>`}),(0,c.jsxs)("div",{className:"y1GiFC_L",children:[(0,c.jsx)("input",{ref:g,type:i,value:t,onChange:e=>{l?.(e.target.value),m(e.target.value.length)},className:"LVdIPwcx",onFocus:()=>{h(!0)},onBlur:()=>{h(!1)},onSelect:e=>{m(e?.target?.selectionStart||0)},readOnly:d,...u}),y&&(0,c.jsx)("span",{className:"lqMFGBuL",style:{left:9*v+"px"}})]})]})}))}}]);