"use strict";(self.webpackChunkproduction_project=self.webpackChunkproduction_project||[]).push([[59],{2059:function(e,a,r){r.r(a),r.d(a,{default:function(){return M}});var n=r(9250),t=r(3007),l=r(5420),s=r(4092),o=r(2327),i=r(7294),c=r(9319),d=r(5401);let u;!function(e){e.INCORRECT_USER_DATA="INCORRECT_USER_DATA",e.INCORRECT_AGE="INCORRECT_AGE",e.INCORRECT_COUNTRY="INCORRECT_COUNTRY",e.NO_DATA="NO_DATA",e.SERVER_ERROR="SERVER_ERROR"}(u||(u={}));var C=r(1715),h=r(8312),m=r(379),g=r(2949);let f;!function(e){e.RUB="RUB",e.EUR="EUR",e.USD="USD"}(f||(f={}));var p=r(881),R=r(5893);const v=[{value:f.RUB,content:f.RUB},{value:f.EUR,content:f.EUR},{value:f.USD,content:f.USD}],x=(0,i.memo)((({className:e,value:a,onChange:r,readonly:n})=>{const{t:t}=(0,o.$)(),l=(0,i.useCallback)((e=>{r?.(e)}),[r]);return(0,R.jsx)(p.w,{onChange:l,value:a,defaultValue:t("Укажите валюту"),items:v,className:e,readonly:n,direction:"top right",label:t("Укажите валюту")})}));let E;!function(e){e.Russia="Russia",e.Belarus="Belarus",e.Ukraine="Ukraine",e.Kazakhstan="Kazahstan",e.Armenia="Armenia"}(E||(E={}));const y=[{value:E.Armenia,content:E.Armenia},{value:E.Russia,content:E.Russia},{value:E.Belarus,content:E.Belarus},{value:E.Kazakhstan,content:E.Kazakhstan},{value:E.Ukraine,content:E.Ukraine}],N=(0,i.memo)((({className:e,value:a,onChange:r,readonly:n})=>{const{t:t}=(0,o.$)(),l=(0,i.useCallback)((e=>{r?.(e)}),[r]);return(0,R.jsx)(p.w,{onChange:l,items:y,defaultValue:t("Укажите страну"),value:a,readonly:n,direction:"top right",label:t("Укажите страну")})}));var j=r(5550),A={ProfileCard:"wW9jgKKD",loading:"t07ZxFGs",error:"i5YK3SSb",editing:"DjTe7269"};const U=e=>{const{className:a,data:r,isLoading:n,error:l,readonly:s,onChangeFirstname:i,onChangeLastname:c,onChangeAge:d,onChangeCity:u,onChangeAvatar:f,onChangeUsername:p,onChangeCountry:v,onChangeCurrency:E}=e,{t:y}=(0,o.$)("profile");if(n)return(0,R.jsx)(j.U,{justify:"center",max:!0,className:(0,t.A)(A.ProfileCard,{[A.loading]:!0},[a]),children:(0,R.jsx)(m.a,{})});if(l)return(0,R.jsx)(j.U,{justify:"center",max:!0,className:(0,t.A)(A.ProfileCard,{},[a,A.error]),children:(0,R.jsx)(C.xv,{theme:C.lg.ERROR,title:y("Произошла ошибка при загрузке профиля"),text:y("Попробуйте обновить страницу"),align:C.PH.CENTER})});const U={[A.editing]:!s};return(0,R.jsxs)(j.g,{gap:"16",max:!0,className:(0,t.A)(A.ProfileCard,U,[a]),children:[r?.avatar&&(0,R.jsx)(j.U,{justify:"center",max:!0,className:A.avatarWrapper,children:(0,R.jsx)(g.q,{src:r?.avatar})}),(0,R.jsx)(h.I,{value:r?.first,placeholder:y("Ваше имя"),className:A.input,onChange:i,readonly:s}),(0,R.jsx)(h.I,{value:r?.lastname,placeholder:y("Ваша фамилия"),className:A.input,onChange:c,readonly:s}),(0,R.jsx)(h.I,{value:r?.age,placeholder:y("Ваш возраст"),className:A.input,onChange:d,readonly:s}),(0,R.jsx)(h.I,{value:r?.city,placeholder:y("Город"),className:A.input,onChange:u,readonly:s}),(0,R.jsx)(h.I,{value:r?.username,placeholder:y("Введите имя пользователя"),className:A.input,onChange:p,readonly:s}),(0,R.jsx)(h.I,{value:r?.avatar,placeholder:y("Введите ссылку на аватар"),className:A.input,onChange:f,readonly:s}),(0,R.jsx)(x,{className:A.input,value:r?.currency,onChange:E,readonly:s}),(0,R.jsx)(N,{className:A.input,value:r?.country,onChange:v,readonly:s})]})};var O=r(9970),T=r(1233);const _=e=>e.profile?.form,k=e=>e.profile?.isLoading,I=e=>e.profile?.error,b=e=>e.profile?.readonly,S=e=>e.profile?.validateErrors;var D=r(4268);const L=(0,D.hg)("profile/fetchProfileData",(async(e,a)=>{const{extra:r,rejectWithValue:n}=a;try{if(!e)throw new Error;const a=await r.api.get(`/profile/${e}`);if(!a.data)throw new Error;return a.data}catch(e){return console.log(e),n("error")}})),P=(0,D.hg)("profile/updateProfileData",(async(e,a)=>{const{extra:r,rejectWithValue:n,getState:t}=a,l=_(t()),s=(e=>{if(!e)return[u.NO_DATA];const{first:a,lastname:r,age:n,country:t}=e,l=[];return a&&r||l.push(u.INCORRECT_USER_DATA),n&&Number.isInteger(n)||l.push(u.INCORRECT_AGE),t||l.push(u.INCORRECT_COUNTRY),l})(l);if(s.length)return n(s);try{const e=await r.api.put(`/profile/${l?.id}`,l);if(!e.data)throw new Error;return e.data}catch(e){return console.log(e),n([u.SERVER_ERROR])}})),w=(0,D.oM)({name:"profile",initialState:{readonly:!0,isLoading:!1,error:void 0,data:void 0},reducers:{setReadonly:(e,a)=>{e.readonly=a.payload},cancelEdit:e=>{e.readonly=!0,e.validateErrors=void 0,e.form=e.data},updateProfile:(e,a)=>{e.form={...e.form,...a.payload}}},extraReducers:e=>{e.addCase(L.pending,(e=>{e.error=void 0,e.isLoading=!0})).addCase(L.fulfilled,((e,a)=>{e.isLoading=!1,e.data=a.payload,e.form=a.payload})).addCase(L.rejected,((e,a)=>{e.isLoading=!1,e.error=a.payload})).addCase(P.pending,(e=>{e.validateErrors=void 0,e.isLoading=!0})).addCase(P.fulfilled,((e,a)=>{e.isLoading=!1,e.data=a.payload,e.form=a.payload,e.readonly=!0,e.validateErrors=void 0})).addCase(P.rejected,((e,a)=>{e.isLoading=!1,e.validateErrors=a.payload}))}}),{actions:B}=w,{reducer:$}=w;var V=r(7081),F=r(5255);const z=e=>e.profile?.data,G=e=>{const{className:a}=e,{t:r}=(0,o.$)("profile"),n=(0,c.v9)(V.m5),l=(0,c.v9)(z),s=n?.id===l?.id,u=(0,c.v9)(b),h=(0,d.T)(),m=(0,i.useCallback)((()=>{h(B.setReadonly(!1))}),[h]),g=(0,i.useCallback)((()=>{h(B.cancelEdit())}),[h]),f=(0,i.useCallback)((()=>{h(P())}),[h]);return(0,R.jsxs)(j.U,{max:!0,justify:"between",className:(0,t.A)("",{},[a]),children:[(0,R.jsx)(C.xv,{title:r("Профиль")}),s&&(0,R.jsx)("div",{children:u?(0,R.jsx)(F.zx,{className:"",theme:F.bn.OUTLINE,onClick:m,children:r("Редактировать")}):(0,R.jsxs)(j.U,{gap:"8",children:[(0,R.jsx)(F.zx,{className:"",theme:F.bn.OUTLINE_RED,onClick:g,children:r("Отменить")}),(0,R.jsx)(F.zx,{className:"",theme:F.bn.OUTLINE,onClick:f,children:r("Сохранить")})]})})]})},K={profile:$},W=(0,i.memo)((e=>{const{className:a,id:r}=e,{t:n}=(0,o.$)("profile"),l=(0,d.T)(),s=(0,c.v9)(_),h=(0,c.v9)(k),m=(0,c.v9)(I),g=(0,c.v9)(b),f=(0,c.v9)(S),p={[u.SERVER_ERROR]:n("Серверная ошибка при сохранении"),[u.INCORRECT_COUNTRY]:n("Некорректный регион"),[u.NO_DATA]:n("Данные не указаны"),[u.INCORRECT_USER_DATA]:n("Имя и фамилия обязательны"),[u.INCORRECT_AGE]:n("Некорректный возраст")};(0,O.Q)((()=>{r&&l(L(r))}));const v=(0,i.useCallback)((e=>{l(B.updateProfile({first:e||""}))}),[l]),x=(0,i.useCallback)((e=>{l(B.updateProfile({lastname:e||""}))}),[l]),E=(0,i.useCallback)((e=>{l(B.updateProfile({city:e||""}))}),[l]),y=(0,i.useCallback)((e=>{l(B.updateProfile({age:Number(e||0)}))}),[l]),N=(0,i.useCallback)((e=>{l(B.updateProfile({username:e||""}))}),[l]),A=(0,i.useCallback)((e=>{l(B.updateProfile({avatar:e||""}))}),[l]),D=(0,i.useCallback)((e=>{l(B.updateProfile({currency:e}))}),[l]),P=(0,i.useCallback)((e=>{l(B.updateProfile({country:e}))}),[l]);return(0,R.jsx)(T.W,{reducers:K,children:(0,R.jsxs)(j.g,{gap:"8",max:!0,className:(0,t.A)("",{},[a]),children:[(0,R.jsx)(G,{}),f?.length&&f.map((e=>(0,R.jsx)(C.xv,{theme:C.lg.ERROR,text:p[e]},e))),(0,R.jsx)(U,{data:s,isLoading:h,error:m,readonly:g,onChangeFirstname:v,onChangeLastname:x,onChangeAge:y,onChangeCity:E,onChangeUsername:N,onChangeAvatar:A,onChangeCurrency:D,onChangeCountry:P})]})})}));var M=({className:e})=>{const{id:a}=(0,n.UO)();return(0,R.jsx)(l.T,{className:(0,t.A)("",{},[e]),children:(0,R.jsx)(s.g,{gap:"16",max:!0,children:(0,R.jsx)(W,{id:a})})})}},1233:function(e,a,r){r.d(a,{W:function(){return s}});var n=r(7294),t=r(9319),l=r(5893);const s=e=>{const{children:a,reducers:r,removeAfterUnmount:s=!0}=e,o=(0,t.oR)(),i=(0,t.I0)();return(0,n.useEffect)((()=>{const e=o.reducerManager.getMountedReducers();return Object.entries(r).forEach((([a,r])=>{e[a]||(o.reducerManager.add(a,r),i({type:`@INIT ${a} reducer`}))})),()=>{s&&Object.entries(r).forEach((([e,a])=>{o.reducerManager.remove(e),i({type:`@DESTROY ${e} reducer`})}))}}),[]),(0,l.jsx)(l.Fragment,{children:a})}},8312:function(e,a,r){r.d(a,{I:function(){return s}});var n=r(7294),t=r(3007),l=r(5893);const s=(0,n.memo)((e=>{const{className:a,value:r,onChange:s,type:o="text",placeholder:i,autofocus:c,readonly:d,...u}=e,C=(0,n.useRef)(null),[h,m]=(0,n.useState)(!1),[g,f]=(0,n.useState)(0),p=h&&!d;return(0,n.useEffect)((()=>{c&&(m(!0),C.current?.focus())}),[c]),(0,l.jsxs)("div",{className:(0,t.A)("LuFDUWoP",{},[a]),children:[i&&(0,l.jsx)("div",{className:"emAQQ85i",children:`${i}>`}),(0,l.jsxs)("div",{className:"y1GiFC_L",children:[(0,l.jsx)("input",{ref:C,type:o,value:r,onChange:e=>{s?.(e.target.value),f(e.target.value.length)},className:"LVdIPwcx",onFocus:()=>{m(!0)},onBlur:()=>{m(!1)},onSelect:e=>{f(e?.target?.selectionStart||0)},readOnly:d,...u}),p&&(0,l.jsx)("span",{className:"lqMFGBuL",style:{left:9*g+"px"}})]})]})}))}}]);