"use strict";(self.webpackChunkproduction_project=self.webpackChunkproduction_project||[]).push([[993],{3818:function(e,a,t){t.r(a),t.d(a,{default:function(){return Q}});var s=t(2327),r=t(7294),i=t(9250),n=t(2241),c=t(3007),d=t(1233),l=t(5420),o=t(5550),m=t(1715);const u=t(6628).p.injectEndpoints({endpoints:e=>({getArticleRecommendationsList:e.query({query:e=>({url:"/articles",params:{_limit:e}})})}),overrideExisting:!1}).useGetArticleRecommendationsListQuery;var x=t(5893);const g=(0,r.memo)((e=>{const{className:a}=e,{t:t}=(0,s.$)(),{data:r,isLoading:i,error:d}=u(3);return i||d||!r?null:(0,x.jsxs)(o.g,{gap:"8",className:(0,c.A)("",{},[a]),children:[(0,x.jsx)(m.xv,{size:m.yH.L,title:t("Рекомендуем")}),(0,x.jsx)(n.wD,{articles:r,target:"_blank"})]})}));var h=t(7779),j=t(4268);const p=(0,j.hg)("articleDetailsPage/fetchArticleRecommendations",(async(e,a)=>{const{extra:t,rejectWithValue:s}=a;try{const e=await t.api.get("/articles",{params:{_limit:4}});if(!e.data)throw new Error;return e.data}catch(e){return s("error")}})),v=(0,j.HF)({selectId:e=>e.id}),C=(v.getSelectors((e=>e.articleDetailsPage?.recommendations||v.getInitialState())),(0,j.oM)({name:"articleDetailsCommentsSlice",initialState:v.getInitialState({isLoading:!1,error:void 0,ids:[],entities:{}}),reducers:{},extraReducers:e=>{e.addCase(p.pending,(e=>{e.error=void 0,e.isLoading=!0})).addCase(p.fulfilled,((e,a)=>{e.isLoading=!1,v.setAll(e,a.payload)})).addCase(p.rejected,((e,a)=>{e.isLoading=!1,e.error=a.payload}))}})),{reducer:L}=C,N=(0,j.hg)("articleDetails/fetchCommentsByArticleId",(async(e,a)=>{const{extra:t,rejectWithValue:s}=a;if(!e)return s("error");try{const a=await t.api.get("/comments",{params:{articleId:e,_expand:"user"}});if(!a.data)throw new Error;return a.data}catch(e){return s("error")}})),f=(0,j.HF)({selectId:e=>e.id}),w=f.getSelectors((e=>e.articleDetailsPage?.comments||f.getInitialState())),y=(0,j.oM)({name:"articleDetailsCommentsSlice",initialState:f.getInitialState({isLoading:!1,error:void 0,ids:[],entities:{}}),reducers:{},extraReducers:e=>{e.addCase(N.pending,(e=>{e.error=void 0,e.isLoading=!0})).addCase(N.fulfilled,((e,a)=>{e.isLoading=!1,f.setAll(e,a.payload)})).addCase(N.rejected,((e,a)=>{e.isLoading=!1,e.error=a.payload}))}}),{reducer:A}=y,I=(0,h.UY)({recommendations:L,comments:A});var S=t(9319),b=t(9332),D=t(5255),k=t(7081);const $=(0,t(2222).P1)(n.wq,k.m5,((e,a)=>!(!e||!a)&&e.user.id===a.id)),O=({className:e})=>{const{t:a}=(0,s.$)("article-details"),t=(0,i.s0)(),d=((0,S.v9)(k.m5),(0,S.v9)(n.wq)),l=(0,S.v9)($),m=(0,r.useCallback)((()=>{t(b.h3.articles)}),[t]),u=(0,r.useCallback)((()=>{t(`${b.h3.article_details}${d?.id}/edit`)}),[t,d?.id]);return(0,x.jsxs)(o.U,{max:!0,justify:"between",className:(0,c.A)("",{},[e]),children:[(0,x.jsx)(D.zx,{theme:D.bn.OUTLINE,onClick:m,children:a("Назад к списку")}),l&&(0,x.jsx)(D.zx,{theme:D.bn.OUTLINE,onClick:u,children:a("Редактировать")})]})},_=(0,r.lazy)((()=>t.e(933).then(t.bind(t,1933))));var q=t(2949),z=t(3312),E=t(6897),U={CommentCard:"xIHByGcu",header:"dsH_3Oqu",username:"dw82WMzO",loading:"V0iZ1Un3"};const H=(0,r.memo)((e=>{const{className:a,comment:t,isLoading:s}=e;return s?(0,x.jsxs)("div",{className:(0,c.A)(U.CommentCard,{},[a,U.loading]),children:[(0,x.jsxs)("div",{className:U.header,children:[(0,x.jsx)(z.O,{width:30,height:30,border:"50%"}),(0,x.jsx)(z.O,{height:16,width:100,className:U.username})]}),(0,x.jsx)(z.O,{className:U.text,width:"100%",height:50})]}):t?(0,x.jsxs)(o.g,{max:!0,gap:"8",className:(0,c.A)(U.CommentCard,{},[a]),children:[(0,x.jsxs)(E.F,{to:`${b.h3.profile}${t.user.id}`,className:U.header,children:[t.user.avatar?(0,x.jsx)(q.q,{size:30,src:t.user.avatar}):null,(0,x.jsx)(m.xv,{className:U.username,title:t.user.username})]}),(0,x.jsx)(m.xv,{className:U.text,text:t.text})]}):null})),P=(0,r.memo)((e=>{const{className:a,isLoading:t,comments:r}=e,{t:i}=(0,s.$)();return t?(0,x.jsxs)(o.g,{gap:"16",max:!0,className:(0,c.A)("",{},[a]),children:[(0,x.jsx)(H,{isLoading:!0}),(0,x.jsx)(H,{isLoading:!0}),(0,x.jsx)(H,{isLoading:!0})]}):(0,x.jsx)(o.g,{gap:"16",max:!0,className:(0,c.A)("",{},[a]),children:r?.length?r.map((e=>(0,x.jsx)(H,{isLoading:t,comment:e},e.id))):(0,x.jsx)(m.xv,{text:i("Комментарии отсутствуют")})})}));var R=t(9970),W=t(379);const F=e=>e.articleDetailsPage?.comments?.isLoading;var V=t(3918);const M=(0,j.hg)("articleDetails/addCommentForArticle",(async(e,a)=>{const{extra:t,dispatch:s,rejectWithValue:r,getState:i}=a,n=(0,k.m5)(i()),c=(0,V.wq)(i());if(!n||!e||!c)return r("no data");try{const a=await t.api.post("/comments",{articleId:c.id,userId:n.id,text:e});if(!a.data)throw new Error;return s(N(c.id)),a.data}catch(e){return r("error")}})),T=({className:e,id:a})=>{const{t:t}=(0,s.$)(),i=(0,S.v9)(w.selectAll),n=(0,S.v9)(F),d=(0,S.I0)(),l=(0,r.useCallback)((e=>{d(M(e))}),[d]);return(0,R.Q)((()=>{d(N(a))})),(0,x.jsxs)(o.g,{max:!0,gap:"16",className:(0,c.A)("",{},[e]),children:[(0,x.jsx)(m.xv,{size:m.yH.L,title:t("Комментарии")}),(0,x.jsx)(r.Suspense,{fallback:(0,x.jsx)(W.a,{}),children:(0,x.jsx)(_,{onSendComment:l})}),(0,x.jsx)(P,{isLoading:n,comments:i})]})},B={articleDetailsPage:I},G=e=>{const{className:a}=e,{t:t}=(0,s.$)("article-details"),{id:r}=(0,i.UO)();return(0,x.jsx)(d.W,{reducers:B,removeAfterUnmount:!0,children:(0,x.jsx)(l.T,{className:(0,c.A)("adu8fSDx",{},[a]),children:(0,x.jsxs)(o.g,{gap:"16",max:!0,children:[(0,x.jsx)(O,{}),(0,x.jsx)(n.D0,{id:r}),(0,x.jsx)(g,{}),(0,x.jsx)(T,{id:r})]})})})};var Q=(0,r.memo)(G)}}]);